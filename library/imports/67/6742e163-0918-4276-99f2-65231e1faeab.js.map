{"version":3,"sources":["assets/script/tool/amuseScroll.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\n\n/**列表draw call优化组件 */\n@ccclass\nexport default class scrollTool extends cc.Component {\n    /* --------------------------------segmentation-------------------------------- */\n    onLoad() {\n        if (!this.node.getComponent(cc.ScrollView)) {\n            cc.error(\"不存在ScrollView组件！\");\n            return;\n        }\n        // ------------------事件监听\n        this.node.on(\"scrolling\", this._event_update_opacity, this);\n        this.node.getComponent(cc.ScrollView).content.on(cc.Node.EventType.CHILD_REMOVED, this._event_update_opacity, this);\n        this.node.getComponent(cc.ScrollView).content.on(cc.Node.EventType.CHILD_REORDER, this._event_update_opacity, this);\n    }\n    /* ***************功能函数*************** */\n    /**获取在世界坐标系下的节点包围盒(不包含自身激活的子节点范围) */\n    private _get_bounding_box_to_world(node_o_: any): cc.Rect {\n        let w_n: number = node_o_._contentSize.width;\n        let h_n: number = node_o_._contentSize.height;\n        let rect_o = cc.rect(\n            -node_o_._anchorPoint.x * w_n, \n            -node_o_._anchorPoint.y * h_n, \n            w_n, \n            h_n\n        );\n        node_o_._calculWorldMatrix();\n        rect_o.transformMat4(rect_o, node_o_._worldMatrix);\n        return rect_o;\n    }\n    /**检测碰撞 */\n    private _check_collision(node_o_: cc.Node): boolean {\n        let rect1_o = this._get_bounding_box_to_world(this.node.getComponent(cc.ScrollView).content.parent);\n        let rect2_o = this._get_bounding_box_to_world(node_o_);\n        // ------------------保险范围\n        rect1_o.width += rect1_o.width * 0.5;\n        rect1_o.height += rect1_o.height * 0.5;\n        rect1_o.x -= rect1_o.width * 0.25;\n        rect1_o.y -= rect1_o.height * 0.25;\n        return rect1_o.intersects(rect2_o);\n    }\n    /* ***************自定义事件***************  */\n    private _event_update_opacity(): void {\n        this.node.getComponent(cc.ScrollView).content.children.forEach(v1_o=> {\n            let rect1_o = this._get_bounding_box_to_world(this.node.getComponent(cc.ScrollView).content.parent);\n            rect1_o.width += rect1_o.width * 0.5;\n            rect1_o.height += rect1_o.height * 0.5;\n            rect1_o.x -= rect1_o.width * 0.25;\n            rect1_o.y -= rect1_o.height * 0.25;\n\n            v1_o.opacity = this._check_collision(v1_o) ? 255 : 0;\n        });\n    }\n}"]}